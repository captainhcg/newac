function mimikoLoad(a){if(window.localStorage){var c=localStorage.getItem("av."+a);return c}else{return null}}function mimikoSave(a,c){if(window.localStorage){localStorage.setItem("av."+a,c)}}function parseStyle(c){var a=c;a=a.replace(/\:\/\//g,"御御子的特殊标记其一").replace(/\n{3,}/g,"\n\n").replace(/\s{2,}/g," ").replace(/：/g,":").replace(/；/g,";").replace(/，/g,",").replace(/！/g,"!").replace(/（/g,"(").replace(/）/g,")").replace(/｛/g,"{").replace(/｝/g,"}").replace(/\s*\:\s*/g,": ").replace(/\s*\;\s*/g," ; ").replace(/\s*\,\s*/g,",").replace(/\s*\!\s*/g,"!").replace(/\s*\(\s*/g,"(").replace(/\s*\)\s*/g,") ").replace(/\s*\{\s*/g,"{").replace(/\s*\}\s*/g," ; }\n").replace(/\/\/(.*)/g,"/*$1*/").replace(/\!{2,}/g," !important").replace(/\#(\d+)\,(\d+)\,(\d+)\,(\d+(?:\.\d+){0,1})/g,"rgba($1,$2,$3,$4)").replace(/\#(\d+)\,(\d+)\,(\d+)/g,"rgb($1,$2,$3)").replace(/\sw\:/g,"width:").replace(/\sh\:/g,"height:").replace(/\sw\+\:/g,"max-width:").replace(/\sw\-\:/g,"min-width:").replace(/\sh\+\:/g,"max-height:").replace(/\sh\-\:/g,"min-height:").replace(/\sl\:/g,"left:").replace(/\sr\:/g,"right:").replace(/\st\:/g,"top:").replace(/\sb\:/g,"bottom:").replace(/\sm\:/g,"margin:").replace(/\sp\:/g,"padding:").replace(/\smt\:/g,"margin-top:").replace(/\smr\:/g,"margin-right:").replace(/\smb\:/g,"margin-bottom:").replace(/\sml\:/g,"margin-left:").replace(/\spt\:/g,"padding-top:").replace(/\spr\:/g,"padding-right:").replace(/\spb\:/g,"padding-bottom:").replace(/\spl\:/g,"padding-left:").replace(/\spos:/g,"position:").replace(/\sdis:/g,"display:").replace(/\szi:/g,"z-index:").replace(/\sc\:/g,"color:").replace(/\sbg\:/g,"background:").replace(/\sbgc\:/g,"background-color:").replace(/\sbgi\:/g,"background-image:").replace(/\sbgr\:/g,"background-repeat:").replace(/\sbgp\:/g,"background-position:").replace(/\sbgo\:/g,"background-origin:").replace(/\sf\:/g,"font:").replace(/\sfs\:/g,"font-size:").replace(/\sfw\:/g,"font-weight:").replace(/\sff\:/g,"font-family:").replace(/\slh\:/g,"line-height:").replace(/\sta\:/g,"text-align:").replace(/\std\:/g,"text-decoration:").replace(/\sbor:/g,"border:").replace(/\sbt:/g,"border-top:").replace(/\sbr:/g,"border-right:").replace(/\sbb:/g,"border-bottom:").replace(/\sbl:/g,"border-left:").replace(/\sborr:/g,"border-radius:").replace(/\sbs:/g,"box-shadow:").replace(/\sts:/g,"text-shadow:").replace(/\s\:h\s/g,":hover ").replace(/\s\:v\s/g,":visited ").replace(/\s\:a\s/g,":active ").replace(/\stra\s/g," transparent ").replace(/\sib\s/g," inline-block ").replace(/\sabs\s/g," absolute ").replace(/\srel\s/g," relative ").replace(/\sl\s/g," left ").replace(/\sr\s/g," right ").replace(/\st\s/g," top ").replace(/\sb\s/g," bottom ").replace(/\sc\s/g," center ").replace(/\sre\s/," repeat ").replace(/\srx\s/," repeat-x ").replace(/\sry\s/," repeat-y ").replace(/\snr\s/," no-repeat ").replace(/\s(\d+)\s/g," $1px ").replace(/\:\s*\/\//g,"://").replace(/z\-index\:\s*(\d)+px/g," z-index: $1 ").replace(/御御子的特殊标记其一/g,"://").replace(/\s\:\s/g,": ").replace(/\:\s*(\S*?)\s*\{/g,":$1{").replace(/\s*\;+\s*/g,"; ").replace(/\;\s\;/g,";").replace(/\,/g,", ");return a}function clearHtml(a){var c=a.replace(/\<[\s\S]+?\>/g,"");return c}function parsePost(para){var mid=setMid();var mimikoText=para.replace(/\n{4,}/g,"[hr]");var mimikoCode=mimikoText.match(/\[code\][\s\S]+?\[\/code\]/g);mimikoText=mimikoText.replace(/\[code\][\s\S]+?\[\/code\]/g,"mimikoCodeIndex"+mid);var mimikoStyle=mimikoText.match(/\[style\][\s\S]+?\[\/style\]/g);mimikoText=mimikoText.replace(/\[style\][\s\S]+?\[\/style\]/g,"mimikoStyleIndex"+mid);var mimikoUrl=mimikoText.match(/\[url.*?\].+?\[\/url\]/g);mimikoText=mimikoText.replace(/\[url.*?\].+?\[\/url\]/g,"mimikoUrlIndex"+mid);var mimikoImg=mimikoText.match(/\[img\].+?\[\/img\]/g);mimikoText=mimikoText.replace(/\[img\].+?\[\/img\]/g,"mimikoImgIndex"+mid);mimikoText=mimikoText.replace(/\[title.*\].*\[\/title\]/g,"").replace(/\b((?:http|ftp)\:\/\/(?:\S)+\b(\/|\#)?)/g,"[url]$1[/url]").replace(/\[url\](.*?\.(?:jpg|png|gif))\[\/url\]/g,"[img]$1[/img]").replace(/\[url\](http\:\/\/.*?\.(?:swf|flv)\S*?)\[\/url\]/g,"[video]$1[/video]").replace(/\[url\](http\:\/\/.*?\.(?:ogg|wav|mp3)\S*?)\[\/url\]/g,"[audio]$1[/audio]").replace(/\[url\]http\:\/\/www\.bilibili\.tv\/video\/(av\d+?)\/?\[\/url\]/g,"$1").replace(/(?:\b|(\W|\D))(av\d+)/g,"$1[url=http://www.bilibili.tv/video/$2/]$2[/url]").replace(/\[url\]http\:\/\/www\.acfun\.tv\/v\/(ac\d+?)\/?\[\/url\]/g,"$1").replace(/(?:\b|(\W|\D))(ac\d+)/g,"$1[url=http://www.acfun.tv/v/$2/]$2[/url]");var mimikoEquation=mimikoText.match(/(\d|(?:\d+d\d+)|\+|\-|\*|\/|\(|\)|\.)+\=[\?？]/g);if(mimikoEquation&&mimikoEquation.length){for(i=0;i<mimikoEquation.length;i++){var mimikoEquationOrigin=mimikoEquation[i].replace(/\=[\?？]/,"");if(mimikoEquationOrigin.search(/\d+d\d+/)==-1){try{var mimikoResult=eval(mimikoEquationOrigin)}catch(e){var mimikoResult=mimikoEquationOrigin}var mimikoString="[title="+mimikoResult+"]"+mimikoEquationOrigin+"=[b]"+mimikoResult+"[/b][/title]"}else{var mimikoEquationSecond=mimikoEquationOrigin;var mimikoDice=mimikoEquationOrigin.match(/\d+d\d+/g);for(n=0;n<mimikoDice.length;n++){mimikoEquationSecond=mimikoEquationSecond.replace(/\d+d\d+/,parseDice(mimikoDice[n]))}try{var mimikoResult=eval(mimikoEquationSecond)}catch(e){var mimikoResult=mimikoEquationSecond}var mimikoString="[title="+mimikoResult+"]"+mimikoEquationOrigin+"=[i]"+mimikoEquationSecond+"[/i]=[b]"+mimikoResult+"[/b][/title]"}mimikoText=mimikoText.replace(/(?:\d|(?:\d+d\d+)|\+|\-|\*|\/|\(|\)|\.)+\=[\?？]/,mimikoString)}}if(mimikoCode&&mimikoCode.length){for(i=0;i<mimikoCode.length;i++){mimikoText=mimikoText.replace("mimikoCodeIndex"+mid,mimikoCode[i])}}if(mimikoStyle&&mimikoStyle.length){for(i=0;i<mimikoStyle.length;i++){mimikoText=mimikoText.replace("mimikoStyleIndex"+mid,mimikoStyle[i])}}if(mimikoUrl&&mimikoUrl.length){for(i=0;i<mimikoUrl.length;i++){mimikoText=mimikoText.replace("mimikoUrlIndex"+mid,mimikoUrl[i])}}if(mimikoImg&&mimikoImg.length){for(i=0;i<mimikoImg.length;i++){mimikoText=mimikoText.replace("mimikoImgIndex"+mid,mimikoImg[i])}}return mimikoText}function parseGet(a){var c=a?a.replace(/\n{4,}/g,"<hr>").replace(/\[extra\][\s\S]*?\[\/extra\]/,"").replace(/\[hr\]/g,"<hr>").replace(/\[b\]([\s|\S]*?)\[\/b\]/g,"<b>$1</b>").replace(/\[i\]([\s|\S]*?)\[\/i\]/g,"<i>$1</i>").replace(/\[u\]([\s|\S]*?)\[\/u\]/g,"<u>$1</u>").replace(/\[font\=([\s|\S]+?)\](\S+?)\[\/font\]/g,'<span style="font-family:$1">$2</span>').replace(/\[size\=(\S+?)\](\S+?)\[\/size\]/g,'<span style="font-size:$1">$2</span>').replace(/\[s\]([\s|\S]*?)\[\/s\]/g,'<span style="text-decoration:line-through">$1</span>').replace(/\[align\=(\S+?)\](\S+?)\[\/align\]/g,'<p style="text-align:$1">$2</p>').replace(/\[url\=(\S+?)\](\S+?)\[\/url\]/g,'<a class="objContentUrl" href="$1">$2</a>').replace(/\[url\](\S+?)\[\/url\]/g,'<a class="objContentUrl" href="$1">$1</a>').replace(/\[img\](\S+?)\[\/img\]/g,'<a class="objContentImage objContentTips" href="$1" target="_blank" title="点击以浏览图像">图像</a>').replace(/\[img\=(\S+?)\](\S+?)\[\/img\]/g,'<a class="objContentImage objContentTips" href="$2" target="_blank" title="$1">图像</a>').replace(/\[video\](\S+?)\[\/video\]/g,'<a class="objContentVideo objContentTips" href="$1" title="点击以浏览影像">影像</a>').replace(/\[audio\](\S+?)\[\/audio\]/g,'<a class="objContentAudio objContentTips" href="$1" title="点击以浏览音声">音声</a>').replace(/\[quote.*?\]([\s|\S]*?)\[\/quote\]/g,'<blockquote class="objContentQuote">$1</blockquote>').replace(/\[code\]([\s|\S]*?)\[\/code\]/g,'<span class="objContentCode objContentTips" title="点击以浏览程式" data-code="$1">程式</span>').replace(/\[style\]([\s|\S]*?)\[\/style\]/g,'<span class="objContentStyle objContentTips" title="点击以浏览样式" data-style="$1">样式</span>').replace(/\[galone\]([\s|\S]*?)\[\/galone\]/g,'<span class="objContentGalone objContentTips" title="点击以启动Galone" data-galone="$1">Galone</span>').replace(/\[size\=(\d+?)\]([\s|\S]*?)\[\/size\]/g,'<span class="objContentSize" style="font-size:$1px">$2</span>').replace(/\[color\=(\S+?)\]([\s|\S]*?)\[\/color\]/g,'<span class="objContentColor" style="color:$1">$2</span>').replace(/\[mask\]([\s|\S]*?)\[\/mask\]/g,'<pre class="objContentMask">$1</pre>').replace(/\[title\=(.*?)\](.*?)\[\/title\]/g,'<span class="objContentTitle" title="$1">$2</span>'):"Error.";return c}function parsePing(a){var d=0;var c=100;d=parseInt((a-500)*100/2000);d=d<0?0:d;d=d>100?100:d;c=100-d;b=0;var e='<span class="tipPing" style="color:rgb('+d+"%,"+c+"%,"+b+'%)">'+a+"ms</span>";return e}function parseString(a){var c=typeof(a)!="string"?JSON.stringify(a):a;return c}function parseJson(para){var mimikoJson=typeof(para)!="object"?eval("("+para+")"):para;return mimikoJson}function setMid(){var a=Math.random().toString().replace(/\./,"");return a}function setOdds(){var a=parseInt(Math.random()*100);return a}function hoverVideoInfo(a,e){var d=$(a).length?$(a):$("div[data-title]");var c;d.each(function(){var g=$(this);var f=g.attr("href")?g:g.find("a");f.unbind("hover").hover(function(){c=window.setTimeout(function(){if(!$("#window-info").length){$("#header").append('<div id="window-info"></div>')}var l=$("#window-info");var o=g.attr("data-preview")?'<img id="preview-info" class="preview" src="'+g.attr("data-preview")+'"></img>':"";var q=g.attr("data-title")?'<span id="title-info" class="title">'+g.attr("data-title")+"</span>":"";var r=g.attr("data-author")?'<span id="author-info"><i class="icon icon-user"></i><span class="name">'+g.attr("data-author")+"</span></span>":"";var p=g.attr("data-desc")?'<span id="desc-info">'+clearHtml(g.attr("data-desc"))+"</span>":"";var m=g.attr("data-date")?'<span id="date-info" class="date"><i class="icon icon-date"></i>'+g.attr("data-date")+"</span>":"";var s=g.attr("data-view")?'<span id="view-info"><i class="icon icon-view"></i><span class="view">'+g.attr("data-view")+"</span>":"";var k=g.attr("data-comment")?'<span id="comment-info"><i class="icon icon-comment"></i><span class="comment">'+g.attr("data-comment")+"</span>":"";l.empty().html('<div id="area-info-left">'+o+r+m+s+"&nbsp;&nbsp;&nbsp;&nbsp;"+k+'</div><div id="area-info-right">'+q+p+"</div>");if(g.offset().top-l.height()<$(window).scrollTop()+64){var j=g.offset().top+g.height()+48;var h=j-24}else{var j=g.offset().top-l.height()-48;var h=j+24}l.css({opacity:0,left:g.offset().left,top:j}).stop(false,true).animate({opacity:1,top:h},250)},250)},function(){clearTimeout(c);if($("#window-info").length){var h=$("#window-info");if(g.offset().top-h.height()<$(window).scrollTop()+64){var j=g.offset().top+g.height()+48}else{var j=g.offset().top-h.height()-48}h.stop(false,true).animate({opacity:0,top:j},250,function(){h.remove()})}})});if($.isFunction(e)){e()}}function bindTabbable(a,e){var c=$(a).length?$(a):$("div.tabbable");var d;c.each(function(){var h=$(this);var g=$(this).find("div.tabbable-outer");var f=$(this).find("div.tabbable-inner");h.find("span.tab").not("span.tab-more").hover(function(){var j=$(this);var k=f.find("ul.page:eq("+j.index()+")");d=window.setTimeout(function(){h.find("span.tab-active").removeClass("tab-active");f.find("ul.page-active").removeClass("page-active");j.addClass("tab-active");k.addClass("page-active");if(h.hasClass("tabbable-x")){f.stop().animate({left:f.position().left+g.offset().left-k.offset().left},250)}else{f.stop().animate({top:f.position().top+g.offset().top-k.offset().top},250)}},250)},function(){clearTimeout(d)})});if($.isFunction(e)){e()}}function readyStage(){system.browser={};if($.browser.msie){$("body").addClass("ie");system.browser.ie=1;if($.browser.version=="6.0"){$("body").addClass("ie6");system.browser.ie6=1}else{if($.browser.version=="7.0"){$("body").addClass("ie7");system.browser.ie7=1}else{if($.browser.version=="8.0"){$("body").addClass("ie8");system.browser.ie8=1}else{if($.browser.version=="9.0"){$("body").addClass("ie9");system.browser.ie9=1}else{if($.browser.version=="10.0"){$("body").addClass("ie10");system.browser.ie10=1}else{$("body").addClass("ie6");system.browser.ie6=1}}}}}}else{if($.browser.webkit){$("body").addClass("webkit");system.browser.webkit=1}else{if($.browser.mozilla){$("body").addClass("firefox");system.browser.ff=1}else{if($.browser.opera){$("body").addClass("opera");system.browser.opera=1}else{$("body").addClass("ie ie6");system.browser.ie=1;system.browser.ie6=1}}}}showInfo("少女祈祷中...");if($.cookie("av.config")){config=$.extend(config,parseJson($.cookie("av.config")));showInfo("配置信息加载完成。")}if(config.stage&&config.stage.enabledebug==1){system.debug=1;showDebugInfo("开启Debug模式。")}else{system.debug=0}if(config.style&&config.style.enablestyle==1){var a=mimikoLoad("style");if(a){$("#nagisa").after('<style id="ushio">'+a+"</style>")}showInfo("自定义样式加载完成")}if(config.stage&&config.stage.enableanimation==0){$.fx.off=true;showDebugInfo("禁用Javascript动画。")}else{showDebugInfo("启用Javascript动画。")}$("#stage").attr({"data-width":parseInt(window.innerWidth/320)*320,"data-hours":new Date().getHours()});showDebugInfo("舞台预热完成。");checkLogin()}function checkLogin(c){system.user={};var a=$.cookie("userinfo");if(a){system.user.online=1;showDebugInfo("已登录用户。");if($.isFunction(c)){c()}}else{system.user.online=-1;$.getJSON("/user_check.aspx",function(e){var d=e;if(d.login){system.user.online=1;showDebugInfo("已登录用户。");if($.isFunction(c)){c()}}else{system.user.online=0;showDebugInfo("尚未登录的用户。");if($.isFunction(c)){c()}}})}}function showInfo(a){if(system.browser.ie6!=0){var c=setMid();$("#area-info").append('<span id="item-info-'+c+'" class="item-info">'+a+"</span>");if($("#area-info>span.item-info").length>20){$("#area-info>span.item-info:first").remove()}var d=$("#item-info-"+c);d.stop(false,true).css({opacity:0,height:0},0).animate({height:16},200).animate({opacity:1},300,function(){d.delay(10000).animate({opacity:0},500,function(){d.remove()})}).mouseover(function(){d.stop().remove()})}}function showDebugInfo(a){if(system.debug){showInfo('<span style="color:rgb(113,199,213)">[Debug] '+a+"</span>")}}function showErrorInfo(a){if(system.browser.ie6){alert(a)}else{showInfo('<span style="color:#f69;">[Error] '+a+"</span>")}}function scrollOnto(a,e){var c=$(a).length?$(a):$("#stage");var d=system.browser.ie6||system.browser.ie7||system.browser.ie8?0:250;$("body, html").stop().animate({scrollTop:c.offset().top},d,function(){if($.isFunction(e)){e()}})}function konami(a){}var system={};var config={};system.debug=1;var madoka;var homura;var mami;var sayaka;var kyouko;
